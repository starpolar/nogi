1. 주요 통신 프로토콜 GB/T 27930 표준에 따라 EV와 충전기 간의 통신은 CAN 통신을 기반으로 이루어지며, 주요 메시지 유형은 다음과 같습니다.  
EV → CCU (충전기 요청 및 상태 정보)  
충전 요청 (Charging Request)  
배터리 상태 정보 (SOC, 전압, 전류 등)  
충전 허용 여부  
CCU → EV (충전 진행 정보)  
충전기 출력 전압/전류 설정값  
충전 진행 상태 (충전 시작, 진행 중, 완료 등)  
오류 코드 (이상 발생 시)  
CCU ↔ Power Module (전력 제어)  
충전 전압 및 전류 설정값  
현재 출력 전압/전류  
모듈 상태 정보 (온도, 고장 여부 등)  
  
---  
1. 충전 중 데이터 흐름 (일반적인 시퀸스)  
★ 정상 충전 상황에서의 데이터 흐름  
EV가 충전 요청을 보냄 (CCU로 요청 메시지 전송)  
CCU가 EV 배터리 상태를 확인 후 충전 허가  
Power Module에 적절한 전압/전류 출력 요청  
Power Module이 설정값을 적용하고 충전 진행  
충전 중에는 EV가 주기적으로 SOC 및 상태 정보 전송  
CCU가 충전 상태를 모니터링하며 Power Module 제어  
충전 완료 또는 EV에서 충전 중지 요청 시 충전 종료  
  
![IMAGE](https://raw.githubusercontent.com/nogi-bot/resources/main/starpolar/images/a523267e-96b9-4b1e-84f6-c249a160b5df-image.png)  
  
---  
1. 분석 프로세스 개요  
CAN 데이터 수집  
• 충전 시작부터 종료까지 전체 로그를 캡처  
* 정차 상태, 충전 시작, 충전 진행 중, 충전 종료 등의 상황별 데이터 확보  
CAN ID 분류 (송신 주체 식별)  
• EV ← CCU 간 주고받는 ID를 정리하여 송신 주체 확인  
* 주기적으로 변하는 데이터가 있는 ID 식별  
페이로드 패턴 분석  
* SOC, 전압, 전류 등이 포함된 메시지 찾기  
* 특정 이벤트 (충전 시작/중지)에서 변하는 값 확인  
실험을 통해 데이터 검증  
• 충전 상태 변화 시 데이터 로그 비교  
* 차량 배터리 상태 변경 후 데이터 반응 관찰  
  
---  
<details><summary>EV → CCU (차량이 보냄) 데이터를 어떻게 식별하는가?<br>(데이터 패턴을 분석해 식별하는 방법)</summary>  
  
  ## **1. CAN 메시지 송수신 패턴 분석 (순서 확인)**<br>  
먼저, **시간순으로 정렬된 CAN 로그를 확인**합니다.  
* EV → CCU 메시지는 **항상 먼저 전송됨**  
* CCU → EV 메시지는 **EV 메시지에 대한 응답**  
✅ **예제 CAN 로그 (시간순 정렬):**  
```plain text  
makefile
복사편집
Timestamp      CAN ID       DLC   Data
-----------------------------------------------------
12:00:00.001   0x1801F456   8     01 00 00 00 00 00 00 00  (EV → CCU, 충전 요청)
12:00:00.002   0x1802F4F4   8     01 00 00 00 00 00 00 00  (CCU → EV, 충전 승인)
12:00:00.003   0x1806F456   8     50 12 34 56 78 9A BC DE  (EV → CCU, 배터리 상태)
12:00:00.004   0x1806F4F4   8     60 00 12 34 56 78 9A BC  (CCU → EV, 충전 상태)

  
```  
🚀 **분석:**  
1️⃣ `0x1801F456` 메시지가 **충전 요청**으로 먼저 전송됨 → **EV가 보낸 메시지**  
2️⃣ `0x1802F4F4` 메시지가 **충전 승인**으로 뒤따라 옴 → **CCU가 응답**  
3️⃣ `0x1806F456` 메시지가 **배터리 상태**로 주기적으로 전송됨 → **EV가 보냄**  
4️⃣ `0x1806F4F4` 메시지가 **충전기 상태** 전송 → **CCU가 보냄**  
**✅ 결론:**  
* **항상 먼저 전송되는 메시지**는 **EV에서 CCU로 보내는 것**  
* **CCU 메시지는 EV 메시지에 대한 응답으로 등장**  
---  
## **🔹 2. CAN ID 규칙 분석 (GB/T 27930 표준 기반)**<br>  
GB/T 27930 표준에 따르면, CAN ID는 특정 패턴을 따릅니다.  
|**CAN ID 패턴**|**송신 주체**|**의미**|  
|:---|:---|:---|
|`0x1801F456`|**EV → CCU**|충전 요청|  
|`0x1802F4F4`|**CCU → EV**|충전 승인/거부|  
|`0x1806F456`|**EV → CCU**|배터리 상태 정보 (SOC, 전압, 전류)|  
|`0x1806F4F4`|**CCU → EV**|충전 상태 정보 (전압, 전류)|  
🚀 **ID 패턴 분석 요약:**  
* `F456` → **EV에서 보냄 (EV → CCU)**  
* `F4F4` → **CCU에서 보냄 (CCU → EV)**  
**✅ 결론:**  
* **ID 끝자리가 ****`F456`****이면 EV 송신 데이터**  
* **ID 끝자리가 ****`F4F4`****이면 CCU 송신 데이터**  
---  
## **🔹 3. 데이터 패턴 분석 (SOC, 전압, 전류 변화 확인)**<br>  
EV는 주기적으로 \*\*배터리 상태(SOC, 전압, 전류)\*\*를 전송합니다.  
* SOC(State of Charge) 값이 **변화하는 메시지**는 EV에서 보낸 것  
✅ **EV에서 보내는 배터리 상태 로그 예제:**  
```plain text  
java
복사편집
Timestamp      CAN ID       DLC   Data
-----------------------------------------------------
12:00:10.000   0x1806F456   8     50 12 34 56 78 9A BC DE  (SOC 50%)
12:00:15.000   0x1806F456   8     52 12 34 56 78 9A BC DE  (SOC 52%)
12:00:20.000   0x1806F456   8     54 12 34 56 78 9A BC DE  (SOC 54%)

  
```  
🚀 **분석:**  
* `0x1806F456` 메시지가 **SOC 50% → 52% → 54%로 변화**  
* **EV가 실시간으로 배터리 정보를 보내고 있음**  
✅ **CCU에서 보내는 충전 상태 로그 예제:**  
```plain text  
java
복사편집
Timestamp      CAN ID       DLC   Data
-----------------------------------------------------
12:00:10.000   0x1806F4F4   8     60 00 12 34 56 78 9A BC  (충전기 설정 전압)
12:00:15.000   0x1806F4F4   8     60 00 12 34 56 78 9A BD  (충전기 전압 조정)
12:00:20.000   0x1806F4F4   8     60 00 12 34 56 78 9A BE  (충전기 전압 조정)

  
```  
🚀 **분석:**  
* `0x1806F4F4` 메시지가 **충전기 전압을 주기적으로 설정**  
* **CCU가 충전 상태를 전송하고 있음**  
**✅ 결론:**  
* **SOC, 전압, 전류 변화 메시지는 EV가 보낸 것**  
* **충전 상태 설정 메시지는 CCU가 보낸 것**  
---  
## **🔹 4. 충전 이벤트 분석 (충전 시작/종료 시점 확인)**<br>  
**충전이 시작되거나 종료될 때 어떤 메시지가 먼저 오는지 확인**하면 EV 송신 데이터를 쉽게 구분할 수 있습니다.  
✅ **충전 시작 로그 예제:**  
```plain text  
makefile
복사편집
12:00:00.001   0x1801F456   (EV → CCU, 충전 요청)
12:00:00.002   0x1802F4F4   (CCU → EV, 충전 승인)

  
```  
🚀 **분석:**  
* `0x1801F456` 메시지가 먼저 등장 → **EV가 충전 요청을 보냄**  
* `0x1802F4F4` 메시지가 응답 → **CCU가 승인**  
✅ **충전 종료 로그 예제:**  
```plain text  
makefile
복사편집
12:30:00.001   0x1808F4F4   (CCU → EV, 충전 종료 요청)
12:30:00.002   0x1809F456   (EV → CCU, 충전 종료 확인)

  
```  
🚀 **분석:**  
* `0x1808F4F4` 메시지가 먼저 등장 → **CCU가 충전 종료 신호 전송**  
* `0x1809F456` 메시지가 응답 → **EV가 충전 종료 확인**  
**✅ 결론:**  
* **충전 시작 시** 먼저 등장하는 메시지는 **EV 송신**  
* **충전 종료 시** 마지막으로 등장하는 메시지는 **EV 송신**  
---  
## **✅ 결론: EV 송신 메시지를 확인하는 방법**<br>  
1️⃣ **CAN 메시지 송수신 순서 분석** → **EV 메시지가 먼저 등장**  
2️⃣ **CAN ID 규칙 분석** → **ID 끝자리가 ****`F456`****이면 EV가 송신**  
3️⃣ **데이터 패턴 분석** → **SOC, 전압, 전류 변화 메시지는 EV가 보냄**  
4️⃣ **충전 이벤트 분석** → **충전 요청/종료 시 먼저 등장하는 메시지는 EV 송신**  
</details>  
  
